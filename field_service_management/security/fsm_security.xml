<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        
        <!-- Module Category -->
        <record id="module_category_field_service" model="ir.module.category">
            <field name="name">Field Service Management</field>
            <field name="description">Field Service Management</field>
            <field name="sequence">20</field>
        </record>
        
        <!-- Groups -->
        
        <!-- FSM User Group -->
        <record id="group_fsm_user" model="res.groups">
            <field name="name">FSM User</field>
            <field name="category_id" ref="module_category_field_service"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
            <field name="comment">Basic access to Field Service Management</field>
        </record>
        
        <!-- FSM Technician Group -->
        <record id="group_fsm_technician" model="res.groups">
            <field name="name">FSM Technician</field>
            <field name="category_id" ref="module_category_field_service"/>
            <field name="implied_ids" eval="[(4, ref('group_fsm_user'))]"/>
            <field name="comment">Access for field service technicians</field>
        </record>
        
        <!-- FSM Manager Group -->
        <record id="group_fsm_manager" model="res.groups">
            <field name="name">FSM Manager</field>
            <field name="category_id" ref="module_category_field_service"/>
            <field name="implied_ids" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="comment">Full access to Field Service Management</field>
        </record>
        
        <!-- Record Rules -->
        
        <!-- Technician can only see their own calls -->
        <record id="fsm_call_technician_rule" model="ir.rule">
            <field name="name">FSM Call: Technician Own</field>
            <field name="model_id" ref="model_fsm_call"/>
            <field name="domain_force">[('technician_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Manager can see all calls -->
        <record id="fsm_call_manager_rule" model="ir.rule">
            <field name="name">FSM Call: Manager All</field>
            <field name="model_id" ref="model_fsm_call"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Technician can only see their own expenses -->
        <record id="fsm_expense_technician_rule" model="ir.rule">
            <field name="name">FSM Expense: Technician Own</field>
            <field name="model_id" ref="model_fsm_expense"/>
            <field name="domain_force">[('technician_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Service Partner can see their own data -->
        <record id="fsm_service_partner_own_rule" model="ir.rule">
            <field name="name">FSM Service Partner: Own</field>
            <field name="model_id" ref="model_fsm_service_partner"/>
            <field name="domain_force">[('technician_ids.user_id', 'in', [user.id])]</field>
            <field name="groups" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Manager can see all service partners -->
        <record id="fsm_service_partner_manager_rule" model="ir.rule">
            <field name="name">FSM Service Partner: Manager All</field>
            <field name="model_id" ref="model_fsm_service_partner"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Spare Request Rules -->
        <record id="fsm_spare_request_technician_rule" model="ir.rule">
            <field name="name">FSM Spare Request: Technician Own</field>
            <field name="model_id" ref="model_fsm_spare_request"/>
            <field name="domain_force">[('technician_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Manager can see all spare requests -->
        <record id="fsm_spare_request_manager_rule" model="ir.rule">
            <field name="name">FSM Spare Request: Manager All</field>
            <field name="model_id" ref="model_fsm_spare_request"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
        
        <!-- Feedback Rules -->
        <record id="fsm_feedback_technician_rule" model="ir.rule">
            <field name="name">FSM Feedback: Technician Read</field>
            <field name="model_id" ref="model_fsm_feedback"/>
            <field name="domain_force">[('technician_id.user_id', '=', user.id)]</field>
            <field name="groups" eval="[(4, ref('group_fsm_technician'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        
        <!-- Multi-company Rules -->
        <record id="fsm_call_company_rule" model="ir.rule">
            <field name="name">FSM Call: Multi-company</field>
            <field name="model_id" ref="model_fsm_call"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_technician_company_rule" model="ir.rule">
            <field name="name">FSM Technician: Multi-company</field>
            <field name="model_id" ref="model_fsm_technician"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_service_partner_company_rule" model="ir.rule">
            <field name="name">FSM Service Partner: Multi-company</field>
            <field name="model_id" ref="model_fsm_service_partner"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_spare_company_rule" model="ir.rule">
            <field name="name">FSM Spare: Multi-company</field>
            <field name="model_id" ref="model_fsm_spare"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_inventory_company_rule" model="ir.rule">
            <field name="name">FSM Inventory: Multi-company</field>
            <field name="model_id" ref="model_fsm_inventory"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_expense_company_rule" model="ir.rule">
            <field name="name">FSM Expense: Multi-company</field>
            <field name="model_id" ref="model_fsm_expense"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
        <record id="fsm_claim_company_rule" model="ir.rule">
            <field name="name">FSM Claim: Multi-company</field>
            <field name="model_id" ref="model_fsm_claim"/>
            <field name="global" eval="True"/>
            <field name="domain_force">['|', ('company_id', '=', False), ('company_id', 'in', company_ids)]</field>
        </record>
        
    </data>
</odoo>